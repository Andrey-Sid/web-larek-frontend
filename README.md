# Проектная работа "Веб-ларек"

[Ссылка на репозиторий](https://github.com/Andrey-Sid/web-larek-frontend.git)

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- Model - слой данных, отвечает за хранение и изменение данных
- View - слой представления, отвечает за отображение данных на странице, 
- Presenter - презентер, отвечает за связь представления и данных.

## Базовый код приложения

### Класс Api
В класс Api входит логика запросов. Адрес сервера передается в конструктор, сюда же передается объект с заголовками запросов. 

Поля:  
- `readonly baseUrl: string` - базовый url для api
- `protected options: RequestInit` - объект с настройками для формирования запроса.
  
Параметры в конструкторе:  
- `baseUrl: string` - url для api
- `options: RequestInit` - объект с настройками для запроса.
  
Методы: 
- `protected handleResponse(response: Response): Promise<object>` - обработка ответа сервера. Если ответ есть, он возвращается в json, иначе формируется ошибка.
- `get(uri: string): Promise<object>` - GET запрос на переданный ендпоинт, возвращение промиса с объектом, содержащимся в ответе сервера.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - прием объекта с данными, они передаются в JSON в теле запроса, данные отправляются на ендпоинт в качестве параметра при вызове метода. POST запрос - параметр по умолчанию, но его можно указать третьим параметром при вызове.

### Класс EventEmitter
Отправляет события и подписывается на события. Используется в презентере для обработки событий, а также в приложении для генерации событий.  

Поля:
- `_events: Map<EventName, Set<Subscriber>>` - хранит события карте - Map. Ключ - это строка или регулярное выражение, значение - это сет коллбэков.

Методы, геттеры и сеттеры:
- `on<T extends object>(eventName: EventName, callback: (event: T) => void)` - подписка на событие.
- `off(eventName: EventName, callback: Subscriber)` - отписка от события.
- `emit<T extends object>(eventName: string, data?: T)` - запуск события.
- `onAll(callback: (event: EmitterEvent) => void)` - подписка на все события.
- `offAll()` - сброс событий.
- `trigger<T extends object>(eventName: string, context?: Partial<T>)` - возвращение функции инициализации события по соответствующему параметру.   

## Слой данных - Model

### Класс Model 
Абстрактный класс. Шаблон для классов слоя данных.  

Поля:
- `protected events: IEvents` - объект класса `EventEmitter` - запуск событий при изменении данных.

Параметры конструктора:
- `events: IEvents` - объект класса `EventEmitter` - запуск события при изменении данных.

### Класс ProductsData
Расширение класса Model. Обеспечивает хранение и логику работы с товарами.

Поля:
- `protected _products: IProduct[]` - массив объектов товаров.

Параметры конструктора:
- параметры `Model`.

Методы, геттеры и сеттеры:
- `set products(value: IProduct[]): void` - запись массива продуктов в _products
- `get products(): IProduct[]` - возврат массива продуктов _products
- `getProduct(id: string): IProduct` - поиск товара по id, возвращает id.

### Класс BasketData
Расширкние класса Model. Обеспечивает хранение и логику товаров в корзине.

Поля:
- `protected _purchases: IProduct[]` - массив добавленных товаров в корзине.

Параметры конструктора:
- параметры `Model`.

Методы, геттеры и сеттеры:
- `get purchases(): IProduct[]` - получение массива товаров, добавленных в корзину (_purchases).
- `addPurchase(value: IProduct): void` - добавление товара в массив _purchases.
- `deletePurchase(id: string): void` - удаление товара из массива _purchases.
- `getQuantity(): number` - возврат количества товаров, добавленных в корзину.
- `checkProduct(id: string)` - проверка по id наличия этого товара в корзине.
- `getTotal(): number` - возврат суммы всех товаров, добавленных в корзину.
- `getIdList(): string[]` - возврат списка id товаров, содержащихся в корзине (эти данные используются для post запроса при оформлении заказа).
- `clear(): void` - очистка корзины (проводится после оформления заказа).

### Класс OrderData
Обеспечивает хранение данных в корзине при оформлении заказа.  

Поля:
- `protected _payment: TPayment` - способ оплаты.
- `protected _email: string` - email покупателя.
- `protected _phone: string` - телефон покупателя.
- `protected _address: string` - адрес покупателя.
- `protected _total: number` - общая стоимость заказа.
- `protected _items: string[]` - перечень id товаров.
  
Параметры в конструкторе:
- параметры `-`
  
Методы, геттеры и сеттеры:
 - `set payment(value: TPayment): void` - запись способа оплаты. 
 - `set email(value: string): void` - запись email покупателя.
 - `set phone(value: string): void` - запись телефона покупателя.
 - `set address(value: string): void` - запись адреса покупателя.
 - `set total(value: number): void` - запись стоимости заказа.
 - `set items(value: string[])`  - запись id товаров.
 - `get customerInfo(): ICustomer` - получение всей информации о заказе для отправки post запроса.

### Класс OrderDataBuilder
Расширение класса Model, билдер класса OrderData.

Поля:  
- `protected order: IOrderData` - экземпляр интерфейса IOrderData (такой же, как экземпляр класс OrderData)

Параметры конструктора:
- параметры `Model`
- `orderConstructor: IOrderConstructor` - класс для создания объектов интерфейса IOrderData.

Методы, геттеры и сеттеры:
- `set purchasesInfo: TPurchasesInfo` - запись информации о корзине. Этап 1.
- `set deliveryInfo: TDeliveryInfo` - запись формы доставки. Этап 2.
- `set contactsInfo: TContactsInfo` - запись контактной информации. Этап 3.
- `getOrderData(): ICustomer` - возвращение готовых данных.


## Слой представления - View

### Класс View
Абстрактный класс. Дженерик. Шаблон для классов слоя представления.

Поля:
- `protected _container: HTMLElement` - DOM элемент, передаваемый в конструкторе.
- `protected events: IEvents` - объект класса `EventEmitter` для создания событий при изменении данных.

Параметры конструктора:
- `container: HTMLElement` - DOM элемент компонента.
- `events: IEvents` - объект класса `EventEmitter` для создания событий при изменении данных.

Методы, геттеры и сеттеры:
- `render(data?: Partial<T>): HTMLElement` - возвращает отрисованный html-элемент по переданным данным.

### Класс Card  
Расширение класса View. Абстрактный класс. У класса общие поля у трех разновидностей карточек в приложении: карточка на главной странице (CardCatalog), карточка подробного описания товара в модальном окне (CardPreview) и карточка товара в корзине (CardBasket).

Поля:
- `protected _id: string` - id карточки товара.
- `protected _title: HTMLHeadingElement` - html-элемент, отображающий название товара.
- `protected _price: HTMLSpanElement` - html-элемент, отображающий цену товара.

Параметры в конструкторе:
- параметры `View`.

Методы, геттеры и сеттеры:
- `set id(value: string): void` - запись id карточки товара.
- `get id(): string`  - получение id карточки товара.
- `set title(value: string): void` - запись имени карточки товара.
- `get title(): string` - получение имени карточки товара.
- `set price(value: string): void` - запись цены товара.
- `get price(): string` - получение цены товара.

### Класс CardCatalog 
Расширение класса Card. Дженерик. Отображает карточки в каталоге на главной странице. 

Поля:
- `protected _image: HTMLImageElement` - html-элемент, отображающий изображения товара
- `protected _category: HTMLSpanElement` - html-элемент, отображающий категории товара.

Параметры в конструкторе:
- параметры `Card`.

Методы, геттеры и сеттеры:
- `protected addCSSClassCategory(value: string): void` - присваивание css-класса html-элементу категории товара в зависимости от ее названия. Устанавливает фоновый цвет. 
- `set image(src: string): void` - запись картинки товара.
- `set category(value: string): void` - запись категории товара.
- `get category(): string` - получение  категории товара. 

### Класс CardBasket
Расширяет класс Card. Отображает карточки товара в корзине.

Поля:
- `_index: HTMLSpanElement` - html-элемент, отображающий номера в корзине.
- `buttonDelCard: HTMLButtonElement` - иконка корзины. По клику на нее происходит удаление карточки товара.

Параметры конструктора:
- параметры класса `Card`. 

Методы, геттеры и сеттеры:
- `set index(value: number): void` - записывает порядковый номер карточки в корзине.

### Класс CardPreview
Расширяет класс CardCatalog. Обеспечивает предварительный просмотр карточки товара с описанием. Есть возможность добавления товара в корзину.

Поля:
- `protected _description: HTMLParagraphElement` - html-элемент, отображающий описание товара.
- `protected buttonBuyDelete: HTMLButtonElement` - кнопка для покупки товара или удаления товара из корзины. Работает, если он уже был добавлен в нее. 

Параметры конструктора:
- параметры класса `CardCatalog`. 

Методы, геттеры и сеттеры:
- `set description(value: string): void` - запись описания товара.
- `set priceCheck(value: boolean): void` - запись логического значения блокировки/разблокировки кнопки добавления в корзину. Если в модальном окне открыт бесценный товар: true - блокирует кнопку, false - разблокирует кнопку.
- `get priceCheck(): boolean` - возвращает логмческое значение для блокировки/разблокировки кнопки добавления в корзину.
- `set state(value: boolean)` - устанавка состояния кнопки: 
  1. в модальном окне открыт бесценный товар, кнопка заблокирована и ей присвоена надпись "Не продается".
  2. в модальном окне открыт товар, который уже находится в корзине, кнопка может удалить товар из корзины, ей присвоена надпись "Убрать из корзины".
  3. в модальном окне открыт товар, которого нет в корзине. Кнопка может добавить товар в корзину, ей присвоена надпись "Купить".  

### Класс Page
Расширение класса View. Основным контейнером служит главная страница приложения. Отображает корзину в шапке сайта и показывант количества добавленного товара. Класс отображает также блока с карточки товаров.

Поля:
- `protected _catalog: HTMLElement` - контейнер для отображения карточек товаров.
- `protected buttonBasket: HTMLButtonElement` - иконка, при нажатии открывает модальное окно с корзиной.
- `protected _counter: HTMLSpanElement` - html-элемент, выводжящий число товаров в корзине.
- `protected screen: HTMLDivElement` - html-элемент, отвечающий за внутренннее содержимое страницы(экран).

Параметры конструктора:
- параметры класса `View`. 

Методы, геттеры и сеттеры:
- `set catalog(cards: HTMLElement[]): void` - записывает карточки в _catalog для отображения их на главной странице.
- `set counter(value: string): void` - записывает количество добавленных товаров в корзину.
- `lockScreen(value: boolean): void` - блокирует/разблокируеи экран(окна), запрещая прокрутку при открытии/закрытии модального окна.

### Класс Basket
Расширяет класс View. Отображает корзину с товарами.

Поля
- `protected _cardsList: HTMLUListElement` - html элемент, отвечающий за отображение списка карточек в корзине
- `protected _totalPrice: HTMLSpanElement;` - html элемент, отвечающий за отображение общей стоимости товаров
- `protected buttonСheckout: HTMLButtonElement` - кнопка "Оформить".

Параметры в конструкторе:
- параметры класса `View`.

Методы, геттеры и сеттеры:
- `set cardsList(cards: HTMLElement[]): void` - устанавливает список карточек добавленных товаров в корзину.
- `set emptyCheck(state: boolean): void` - блокирует кнопку "Оформить" при пустой корзине.
- `set total(value: number)` - выводит общую стоимость товаров в html элемент _totalPrice.
 
### Класс Modal
Расширяет класс View. Реализует модальное окно. Устанавливает слушатели на клик в оверлей и крестик для закрытия всплывабщего окна.  

Поля:
- `protected _content: HTMLElement` - содержимое модального окна.
- `protected buttonClose: HTMLButtonElement` - кнопка закрытия модального окна.

Параметры конструктора:
- параметры `View`.

Методы, геттеры и сеттеры:
- `set content(value: HTMLElement): void` - изменение внутреннего содержимого модального окна.
- `open(): void` - отображение модального окна.
- `close(): void` - закрытие модального окна.

#### Класс Form
Расширяет класс View. Абстрактный класс дженерика. Шаблон формы приложения.  

Поля:
- `protected container: HTMLFormElement` - соответствующая форма.
- `protected inputsList: HTMLInputElement[]` - массив input элементов формы.
- `protected submitButton: HTMLButtonElement` - кнопка отправки формы.
- `protected _errorMessage: HTMLSpanElement` - html-элемент отображения ошибок формы.

Параметры в конструкторе:
- параметры `View`.
  
Методы, геттеры и сеттеры:
- `get valid(): boolean` - получение статуса валидности формы.
- `set valid(value: boolean):void` - запись для блокировки (true) / разблокировки (false) кнопки submit.
- `set errorMessage(value: string)` - установка текста ошибок.
- `clear():void` - очистка формы.
- `render(data: Partial<T> & TForm ): HTMLElement` - render View для форм с уччетом обязательных полей valid и errorMessage.  

### Класс FormOrder
Расширяет класс Form. Форма для указания способа доставки и адреса доставки.

Поля:
- `protected containerButtons: HTMLDivElement` - контейнер, содержащий кнопки "онлайн" и "при получении".
- `protected buttonCard: HTMLButtonElement` - кнопка "онлайн".
- `protected buttonCash: HTMLButtonElement` - кнопка "при получении".
- `protected inputAddress: HTMLInputElement` - поле для ввода адреса.

Параметры конструктора:
- параметры `Form`.
 
Методы, геттеры и сеттеры:
- `protected getButtonActive(): HTMLButtonElement | null` - возвращает кнопку, которая активна, либо null, если активных кнопок нет.
- `protected resetButtons(): void` - очищает класс активности с кнопок "Онлайн" и "При получении".
- `clear(): void` - очистка формы, снятие активности с кнопок.
- `get payment(): TPayment | null` - возврат имени активной кнопки, либо null.
- `get address(): string` -  возврат адреса покупателя.
- `get valid(): boolean` - возврат валидности формы. Форма валидна, если была нажата одна из кнопок, а поле ввода не пустое. Также записывает текст ошибки.
- `set valid(value: boolean):void` - запись блокировки (true) / разблокировки (false) кнопки submit.
  
### Класс FormContacts
Расширяет класс Form. Форма для указания телефона и email покупателя.

Поля
- `protected inputEmail: HTMLInputElement` - текстовое поле email.
- `protected inputPhone: HTMLInputElement` - текстовое поле номера телефона.

Параметры в конструкторе:
- параметры `Form`.

Методы, геттеры и сеттеры:
- `get email(): string` - возвращает email из поля ввода email.
- `get phone(): string` - возвращает номер телефона из поля ввода phone.
- `get valid(): boolean` - возвращает валидность формы. Форма валидна, если все поля заполнены. Также записывается текст ошибки.
- `set valid(value: boolean):void` - запись блокировки (true) / разблокировки (false) кнопки submit. 

### Класс Success
Наследует класс View. Уведомление об успешной покупке. Содержит кнопку "за новыми покупками!".

Поля
- `protected buttonOrderSuccess: HTMLButtonElement` - кнопка "за новыми покупками"
- `protected _description: HTMLParagraphElement` - html-элемент, выводящий потраченные средства на все покупки.

Параметры в конструкторе:
- параметры `View`

Методы, геттеры и сеттеры:
- `set description(total: string): void` - установка количества потраченных средств в html элемент _description.

## Слой коммуникации

### Класс AppApi
Расширение класса Api. Предоставление методов взаимодействия с бэкендом сервиса.

Поля:
- `protected cdn: string` - путь до изображений карточек, передаваемый в конструкторе. 

Параметры в конструкторе:
- параметры `Api`
- `cdn: string` - базовый путь до изображений карточек.

Методы, геттеры и сеттеры:
- `getProducts(): Promise<IProduct[]>` - получкемк с сервера массивв объектов всех товаров.
- `getProductById(id: string): Promise<IProduct>` - получение с сервера товарв по id.
- `postOrder(order: ICustomer): Promise<TSuccessData> ` - отправка post-запроса на сервер с данными о заказе, получение id заказа и общей сумму (total).

## Взаимодействие компонентов - слой Presenter
Логика взаимодействия представления и данных реализуется в файле `index.ts`. Это презентер.
Взаимодействие происходит при помощи событий, генерируемых брокером событий и их обработчиком, описанными в `index.ts`.
В `index.ts` создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

## *События, которые могут генерироваться в системе:*

### *События изменения данных (генерируются классами - моделями данных):*

- `products:changed` - изменение данных продуктов.
- `purchases:changed` - изменение покупок (добавление в корзину выбранных поккупателем товаров).
- `success:changed` - событие получения (изменения) данных успешного заказа.

### *События взаимодействия пользователя с интерфейсом (генерируются классами, отвечающими за представление):*

- `modal:open` - открытие модального окна.
- `modal:close` - закрытие модального окна.
- `modal-card:open` - выбор карточки для отображения в модальном окне.
- `modal-basket:open` - открытие модального окна для отображения корзины.
- `purchases:add` - добавление товара в покупки.
- `purchases:delete` - удалении товара из покупок.
- `modal-order:open` - открытие модального окна с формой доставки.
- `order:valid` - действия покупателя с полями формы доставки.
- `order:submit` - кспешное заполнение формы доставки.
- `contacts:valid` - действия покупателя с полями формы контактных данных.
- `contacts:submit` - успешное заполнение формы контактных данных.